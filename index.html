<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FCAST - HTML Creative Engine</title>
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons CDN -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- JSZip for ZIP Generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Space Grotesk', sans-serif; }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        .animate-in { animation: fadeInUp 0.7s ease-out; }
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 transition-colors duration-500" id="app-body">

    <!-- Navigation Bar -->
    <nav class="sticky top-0 z-50 px-8 py-4 flex justify-between items-center border-b backdrop-blur-xl bg-white/80 border-slate-200" id="navbar">
        <div class="flex items-center gap-3 cursor-pointer group" onclick="showPage('home')">
            <div class="bg-blue-600 p-2.5 rounded-xl shadow-lg shadow-blue-600/20 group-hover:scale-110 transition-transform">
                <i data-lucide="layers" class="w-5 h-5 text-white"></i>
            </div>
            <div>
                <span class="font-black text-xl tracking-tight block leading-none">FCAST</span>
                <span class="text-[10px] uppercase tracking-[0.2em] font-bold opacity-50">HTML Engine</span>
            </div>
        </div>

        <div class="flex items-center gap-6">
            <button onclick="toggleDarkMode()" class="p-2.5 rounded-full border transition-all border-slate-200 bg-white hover:bg-slate-100 shadow-sm" id="theme-toggle">
                <i data-lucide="moon" class="w-5 h-5 text-blue-600"></i>
            </button>
        </div>
    </nav>

    <!-- Main Content Container -->
    <main class="max-w-[1400px] mx-auto p-8" id="main-content">
        <!-- Content will be dynamically loaded here -->
    </main>

    <!-- Footer -->
    <footer class="mt-24 py-12 px-8 text-center border-t border-slate-200 bg-white" id="footer">
        <div class="flex flex-col items-center gap-4">
            <div class="bg-blue-600/10 p-3 rounded-2xl text-blue-500">
                <i data-lucide="layers" class="w-6 h-6"></i>
            </div>
            <p class="text-sm font-bold opacity-30 uppercase tracking-[0.4em]">FCAST HTML CREATIVE ENGINE v2.0</p>
        </div>
    </footer>

    <!-- Load Configuration Files -->
    <script src="js/config/languages.js"></script>
    <script src="js/config/templates-config.js"></script>
    <script src="js/config/api-config.js"></script>
    
    <!-- Load Utility Files -->
    <script src="js/utils/gemini-api.js"></script>
    <script src="js/utils/zip-generator.js"></script>
    
    <!-- Load Template Files -->
    <script src="js/templates/template1.js"></script>
    <script src="js/templates/template2.js"></script>
    <script src="js/templates/template3.js"></script>
    <script src="js/templates/template4.js"></script>
    <script src="js/templates/template5.js"></script>
    <script src="js/templates/template6.js"></script>

    <!-- Main App Logic -->
    <script>
        // Global State
        let isDarkMode = false;
        let currentPage = 'home';
        let selectedTemplate = null;
        let adData = {
            title: '',
            tagline: '',
            language: 'en',
            icon: null,
            images: [],
            videos: []
        };

        // Initialize App
        function initApp() {
            showPage('home');
            lucide.createIcons();
        }

        // Dark Mode Toggle
        function toggleDarkMode() {
            isDarkMode = !isDarkMode;
            const body = document.getElementById('app-body');
            const navbar = document.getElementById('navbar');
            const footer = document.getElementById('footer');
            const themeToggle = document.getElementById('theme-toggle');

            if (isDarkMode) {
                body.className = 'bg-[#0a0c10] text-white transition-colors duration-500';
                navbar.className = 'sticky top-0 z-50 px-8 py-4 flex justify-between items-center border-b backdrop-blur-xl bg-[#0a0c10]/80 border-slate-800';
                footer.className = 'mt-24 py-12 px-8 text-center border-t border-slate-900 bg-slate-950/50';
                themeToggle.className = 'p-2.5 rounded-full border transition-all border-slate-800 bg-slate-900 hover:bg-slate-800';
                themeToggle.innerHTML = '<i data-lucide="sun" class="w-5 h-5 text-yellow-400"></i>';
            } else {
                body.className = 'bg-slate-50 text-slate-900 transition-colors duration-500';
                navbar.className = 'sticky top-0 z-50 px-8 py-4 flex justify-between items-center border-b backdrop-blur-xl bg-white/80 border-slate-200';
                footer.className = 'mt-24 py-12 px-8 text-center border-t border-slate-200 bg-white';
                themeToggle.className = 'p-2.5 rounded-full border transition-all border-slate-200 bg-white hover:bg-slate-100 shadow-sm';
                themeToggle.innerHTML = '<i data-lucide="moon" class="w-5 h-5 text-blue-600"></i>';
            }
            
            lucide.createIcons();
            if (currentPage === 'editor') showPage('editor');
        }

        // Page Navigation
        function showPage(page) {
            currentPage = page;
            const mainContent = document.getElementById('main-content');
            
            if (page === 'home') {
                mainContent.innerHTML = renderHomePage();
            } else if (page === 'editor') {
                mainContent.innerHTML = renderEditorPage();
            }
            
            lucide.createIcons();
            window.scrollTo(0, 0);
        }

        // Render Home Page
        // Render Home Page (WITH LIVE PREVIEWS)
function renderHomePage() {
    const cardClass = isDarkMode 
        ? 'bg-[#151921] border-slate-800' 
        : 'bg-white border-slate-200 shadow-xl shadow-slate-200/50';

    return `
        <div class="space-y-12 animate-in">
            <div class="flex flex-col md:flex-row md:items-end justify-between gap-6">
                <div class="max-w-2xl">
                    <h1 class="text-6xl font-black mb-4 tracking-tight leading-tight">
                        HTML <span class="text-blue-600">Ad Designs</span>
                    </h1>
                    <p class="text-lg opacity-60 font-medium">Select a high-performance framework to generate your Google Ads HTML Ad in seconds.</p>
                </div>
                <div class="flex gap-3">
                    <button onclick="scrollTemplates('left')" class="p-4 rounded-full bg-blue-600/10 hover:bg-blue-600/20 text-blue-500 transition-colors">
                        <i data-lucide="chevron-left" class="w-6 h-6"></i>
                    </button>
                    <button onclick="scrollTemplates('right')" class="p-4 rounded-full bg-blue-600/10 hover:bg-blue-600/20 text-blue-500 transition-colors">
                        <i data-lucide="chevron-right" class="w-6 h-6"></i>
                    </button>
                </div>
            </div>

            <div id="template-scroll" class="flex gap-6 overflow-x-auto pb-12 scrollbar-hide snap-x snap-mandatory">
                ${TEMPLATES.map(template => `
                    <div onclick="selectTemplate(${template.id})" class="min-w-[400px] md:min-w-[480px] snap-center group relative overflow-hidden rounded-[2.5rem] border transition-all hover:border-blue-500/50 cursor-pointer ${cardClass}">
                        <div class="aspect-[4/3] overflow-hidden relative bg-black">
                            ${generateTemplatePreviewCard(template)}
                            <div class="absolute inset-0 bg-gradient-to-t from-[#151921] via-transparent to-transparent opacity-40"></div>
                            <div class="absolute top-6 left-6">
                                <span class="px-4 py-1.5 rounded-full bg-blue-600 text-white text-[10px] font-black uppercase tracking-widest shadow-lg">
                                    ${template.type}
                                </span>
                            </div>
                        </div>
                        <div class="p-8">
                            <h3 class="text-2xl font-black mb-2">${template.name}</h3>
                            <p class="text-sm opacity-50 mb-6 font-medium line-clamp-2">${template.description}</p>
                            <div class="flex items-center gap-2 text-blue-500 font-bold group-hover:gap-4 transition-all">
                                Customize Template <i data-lucide="arrow-right" class="w-4 h-4"></i>
                            </div>
                        </div>
                    </div>
                `).join('')}
            </div>
        </div>
    `;
}

// NEW FUNCTION: Generate Live Template Preview Cards
function generateTemplatePreviewCard(template) {
    const demoTitle = 'Time Warp Scan';
    const demoTagline = 'Create Viral Time Effects';
    const iconUrl = 'assets/icon.png';
    const img1 = 'assets/feature_1_image.png';
    const img2 = 'assets/feature_2_image.png';
    const img3 = 'assets/feature_3_image.png';

    switch(template.id) {
        case 1: // Store Style
            return `
                <div style="width:100%; height:100%; display:flex; flex-direction:column; align-items:center; justify-content:center; padding:24px; background: radial-gradient(circle at top, #1a1a3e 0%, #0f0f23 100%); color:white; font-family: 'Space Grotesk', sans-serif;">
                    <img src="${iconUrl}" style="width:100px; height:100px; border-radius:22px; margin-bottom:16px; box-shadow: 0 10px 30px rgba(0,0,0,0.5);">
                    <div style="color: #FFD700; font-size:18px; margin-bottom:8px;">★★★★★ 4.8</div>
                    <h1 style="font-size:26px; font-weight:700; margin-bottom:4px;">${demoTitle}</h1>
                    <p style="font-size:14px; opacity:0.9; margin-bottom:20px;">${demoTagline}</p>
                    <div style="display:flex; gap:10px; margin-bottom:20px;">
                        <span style="background:rgba(255,255,255,0.1); padding:6px 12px; border-radius:8px; font-size:12px;">#1 Trending</span>
                        <span style="background:rgba(255,255,255,0.1); padding:6px 12px; border-radius:8px; font-size:12px;">FREE</span>
                    </div>
                    <button style="background: linear-gradient(135deg, #8b5cf6 0%, #06b6d4 100%); padding:16px 48px; border-radius:50px; border:none; font-size:18px; font-weight:700; color:white;">DOWNLOAD FREE</button>
                </div>
            `;

        case 2: // Feature Orbit
            return `
                <div style="width:100%; height:100%; display:flex; flex-direction:column; align-items:center; justify-content:space-between; padding:16px; background: linear-gradient(135deg, #0f0f23, #1a1a3e); color:white; font-family: 'Space Grotesk', sans-serif;">
                    <div style="text-align:center; margin-bottom:20px;">
                        <h1 style="font-size:24px; font-weight:700; margin-bottom:4px;">${demoTitle}</h1>
                        <p style="font-size:14px; opacity:0.9;">${demoTagline}</p>
                    </div>
                    <div style="display:flex; gap:12px; align-items:center; justify-content:center; margin-bottom:20px;">
                        <img src="${img1}" style="width:80px; height:80px; border-radius:12px; opacity:0.6;">
                        <img src="${img2}" style="width:120px; height:120px; border-radius:16px; border:2px solid #8b5cf6; box-shadow: 0 20px 60px rgba(139, 92, 246, 0.4);">
                        <img src="${img3}" style="width:80px; height:80px; border-radius:12px; opacity:0.6;">
                    </div>
                    <button style="background: linear-gradient(135deg, #8b5cf6, #6366f1); padding:12px 32px; border-radius:50px; border:none; font-size:16px; font-weight:700; color:white;">Download Free</button>
                </div>
            `;

        case 3: // Premium Cards
            return `
                <div style="width:100%; height:100%; display:flex; flex-direction:column; align-items:center; justify-content:space-between; padding:40px 20px; background: radial-gradient(circle at center, #1a1a3e 0%, #0f0f23 100%); color:white; font-family: 'Space Grotesk', sans-serif;">
                    <div style="text-align:center;">
                        <h1 style="font-size:28px; font-weight:700; margin-bottom:4px;">${demoTitle}</h1>
                        <p style="font-size:14px; opacity:0.9;">${demoTagline}</p>
                    </div>
                    <div style="display:flex; gap:12px; align-items:center;">
                        <div style="background:rgba(255,255,255,0.1); backdrop-filter:blur(10px); border-radius:20px; padding:20px; transform:scale(0.8); opacity:0.6;">
                            <img src="${img1}" style="width:60px; height:60px; border-radius:12px;">
                        </div>
                        <div style="background:rgba(255,255,255,0.1); backdrop-filter:blur(10px); border:1px solid #8b5cf6; border-radius:20px; padding:20px;">
                            <img src="${img2}" style="width:80px; height:80px; border-radius:12px;">
                        </div>
                        <div style="background:rgba(255,255,255,0.1); backdrop-filter:blur(10px); border-radius:20px; padding:20px; transform:scale(0.8); opacity:0.6;">
                            <img src="${img3}" style="width:60px; height:60px; border-radius:12px;">
                        </div>
                    </div>
                    <button style="background: linear-gradient(135deg, #8b5cf6 0%, #6366f1 100%); padding:16px 48px; border-radius:50px; border:none; font-size:18px; font-weight:700; color:white;">DOWNLOAD FREE</button>
                </div>
            `;

        case 4: // 3D Scan Pane
            return `
                <div style="width:100%; height:100%; display:flex; flex-direction:column; align-items:center; justify-content:space-between; padding:35px 20px; background: radial-gradient(circle at 50% 50%, #3a035a 0%, #000000 100%); color:white; font-family: 'Space Grotesk', sans-serif;">
                    <h1 style="font-size:38px; font-weight:800; background: linear-gradient(180deg, #FFFFFF 20%, #00d4ff 60%, #ff00ff 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; text-transform:uppercase; transform:skewX(-5deg);">${demoTitle}</h1>
                    <div style="position:relative; width:220px; height:340px; border-radius:12px; overflow:hidden; border:1px solid rgba(255,255,255,0.2); box-shadow: 0 25px 50px rgba(0,0,0,0.5);">
                        <img src="${img1}" style="width:100%; height:100%; object-fit:cover;">
                        <div style="position:absolute; top:0; left:0; right:0; height:4px; background: linear-gradient(to right, transparent, #00d4ff, #ff00ff, #00d4ff, transparent);"></div>
                        <div style="position:absolute; top:15px; left:15px; font-size:10px; font-weight:bold;">REC ●</div>
                    </div>
                    <button style="background: linear-gradient(135deg, #ff00ff 0%, #a100ff 100%); padding:12px 42px; border-radius:4px; border:none; font-size:16px; font-weight:800; color:white; text-transform:uppercase;">START NOW</button>
                </div>
            `;

        case 5: // Minimal Blur
            return `
                <div style="width:100%; height:100%; position:relative; display:flex; flex-direction:column; align-items:center; justify-content:center; background:#000;">
                    <img src="${img1}" style="position:absolute; inset:0; width:100%; height:100%; object-fit:cover; filter:blur(20px) brightness(0.4);">
                    <div style="position:relative; z-index:10; display:flex; flex-direction:column; align-items:center; text-align:center; color:white; font-family: 'Space Grotesk', sans-serif;">
                        <img src="${iconUrl}" style="width:90px; height:90px; border-radius:20px; margin-bottom:20px; box-shadow: 0 15px 35px rgba(0,0,0,0.6);">
                        <h1 style="font-size:32px; font-weight:800; text-transform:uppercase; margin-bottom:30px; text-shadow: 0 4px 15px rgba(0,0,0,0.8);">${demoTitle}</h1>
                        <button style="background:#FFFFFF; color:#000; padding:18px 80px; border-radius:4px; border:none; font-size:20px; font-weight:800; text-transform:uppercase;">Download The App</button>
                    </div>
                </div>
            `;

        case 6: // Video Scan
            return `
                <div style="width:100%; height:100%; display:flex; flex-direction:column; align-items:center; justify-content:space-between; padding:35px 20px; background: radial-gradient(circle at 50% 50%, #3a035a 0%, #000000 100%); color:white; font-family: 'Space Grotesk', sans-serif;">
                    <h1 style="font-size:38px; font-weight:800; background: linear-gradient(180deg, #FFFFFF 20%, #00d4ff 60%, #ff00ff 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; text-transform:uppercase; transform:skewX(-5deg);">${demoTitle}</h1>
                    <div style="position:relative; width:220px; height:340px; border-radius:12px; overflow:hidden; border:1px solid rgba(255,255,255,0.2); box-shadow: 0 25px 50px rgba(0,0,0,0.5); background:#1a1a3e;">
                        <div style="position:absolute; top:50%; left:50%; transform:translate(-50%, -50%); font-size:48px;">▶</div>
                        <div style="position:absolute; top:0; left:0; right:0; height:4px; background: linear-gradient(to right, transparent, #00d4ff, #ff00ff, #00d4ff, transparent);"></div>
                        <div style="position:absolute; top:15px; left:15px; font-size:10px; font-weight:bold;">REC ●</div>
                    </div>
                    <button style="background: linear-gradient(135deg, #ff00ff 0%, #a100ff 100%); padding:12px 42px; border-radius:4px; border:none; font-size:16px; font-weight:800; color:white; text-transform:uppercase;">START NOW</button>
                </div>
            `;

        default:
            return `<img src="${template.preview}" class="w-full h-full object-cover">`;
    }
}
        // Render Editor Page
        function renderEditorPage() {
            if (!selectedTemplate) return '';

            const inputClass = isDarkMode 
                ? 'bg-[#0a0c10] border-slate-800 text-white' 
                : 'bg-slate-50 border-slate-100 text-slate-900';
            
            const panelClass = isDarkMode 
                ? 'bg-[#151921] border-slate-800' 
                : 'bg-white border-slate-200';

            const inputs = selectedTemplate.inputs;

            return `
                <div class="space-y-8 animate-in">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-4">
                            <button onclick="showPage('home')" class="p-3 hover:bg-blue-600/10 rounded-2xl transition-colors border border-transparent hover:border-blue-600/20">
                                <i data-lucide="chevron-left" class="w-6 h-6"></i>
                            </button>
                            <div>
                                <h2 class="text-3xl font-black tracking-tight">${selectedTemplate.name}</h2>
                                <p class="text-sm opacity-50 font-medium">Step 2: Enter Assets & Content</p>
                            </div>
                        </div>
                    </div>

                    <div class="grid lg:grid-cols-2 gap-10 items-start">
                        
                        <!-- INPUTS PANEL -->
                        <div class="p-8 rounded-[2.5rem] border shadow-2xl ${panelClass}">
                            <div class="space-y-8">
                                
                                ${inputs.title ? `
                                <!-- Title & Suggestions -->
                                <section class="space-y-4">
                                    <div class="flex items-center justify-between">
                                        <label class="text-sm font-bold uppercase tracking-widest opacity-40">App Title *</label>
                                        ${inputs.tagline ? `
                                        <button onclick="getSuggestions()" id="suggest-btn" class="text-[10px] flex items-center gap-1.5 bg-blue-600/10 text-blue-500 px-3 py-1.5 rounded-full font-bold uppercase hover:bg-blue-600/20 transition-all">
                                            <i data-lucide="sparkles" class="w-3 h-3"></i> Get Suggestions
                                        </button>
                                        ` : ''}
                                    </div>
                                    <input 
                                        type="text" 
                                        id="app-title"
                                        placeholder="e.g. FitTrack Pro"
                                        oninput="updateAdData('title', this.value)"
                                        class="w-full p-5 rounded-2xl border-2 outline-none focus:border-blue-500 transition-all font-bold text-lg ${inputClass}"
                                    />
                                    ${inputs.tagline ? '<div id="suggestions-container"></div>' : ''}
                                </section>
                                ` : ''}

                                ${inputs.tagline ? `
                                <!-- Tagline & Translation -->
                                <section class="space-y-4">
                                    <label class="text-sm font-bold uppercase tracking-widest opacity-40">Tag Line *</label>
                                    <textarea 
                                        rows="3"
                                        id="app-tagline"
                                        placeholder="Describe your app in one powerful sentence..."
                                        oninput="updateAdData('tagline', this.value)"
                                        class="w-full p-5 rounded-2xl border-2 outline-none focus:border-blue-500 transition-all font-medium ${inputClass}"
                                    ></textarea>
                                    
                                    <div class="space-y-3">
                                        <input 
                                            type="text" 
                                            id="language-search"
                                            placeholder="Search language (e.g., 'en' for English, 'ur' for Urdu)..."
                                            oninput="filterLanguages(this.value)"
                                            class="w-full p-3 rounded-xl border-2 outline-none text-sm ${inputClass}"
                                        />
                                        <div class="flex gap-3">
                                            <select id="language-select" onchange="updateAdData('language', this.value)" class="flex-1 p-4 rounded-xl border-2 outline-none font-bold ${inputClass}">
                                                ${Object.entries(LANGUAGES_MAP).map(([name, code]) => 
                                                    `<option value="${code}">${name} (${code})</option>`
                                                ).join('')}
                                            </select>
                                            <button onclick="translateTagline()" id="translate-btn" class="px-8 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-xl shadow-lg shadow-blue-600/20 flex items-center justify-center">
                                                <i data-lucide="globe" class="w-5 h-5"></i>
                                            </button>
                                        </div>
                                    </div>
                                </section>
                                ` : ''}

                                <!-- Asset Upload Section -->
                                <section class="grid ${inputs.icon && (inputs.images > 0 || inputs.videos > 0) ? 'grid-cols-2' : 'grid-cols-1'} gap-6 pt-6 border-t ${isDarkMode ? 'border-slate-800/50' : 'border-slate-200'}">
                                    
                                    ${inputs.icon ? `
                                    <!-- App Icon Upload -->
                                    <div class="space-y-4 ${!inputs.images && !inputs.videos ? 'col-span-full' : ''}">
                                        <span class="text-xs font-black uppercase tracking-widest opacity-40 flex items-center gap-2">
                                            <i data-lucide="image" class="w-3.5 h-3.5"></i> App Icon *
                                        </span>
                                        <label class="flex flex-col items-center justify-center aspect-square rounded-3xl border-2 border-dashed cursor-pointer transition-all hover:bg-blue-600/5 group ${isDarkMode ? 'border-slate-800 hover:border-blue-500' : 'border-slate-200 hover:border-blue-400'}">
                                            <div class="p-3 rounded-full bg-blue-600/10 text-blue-500 group-hover:scale-110 transition-transform mb-3">
                                                <i data-lucide="image" class="w-6 h-6"></i>
                                            </div>
                                            <span class="text-[10px] font-black uppercase tracking-widest opacity-60">Upload Icon</span>
                                            <input type="file" class="hidden" onchange="handleFileUpload('icon', event)" accept="image/*">
                                        </label>
                                        <div id="icon-preview"></div>
                                    </div>
                                    ` : ''}

                                    ${inputs.images > 0 ? `
                                    <!-- Images Upload -->
                                    <div class="space-y-4 ${inputs.icon ? '' : 'col-span-full'}">
                                        <span class="text-xs font-black uppercase tracking-widest opacity-40 flex items-center gap-2">
                                            <i data-lucide="image" class="w-3.5 h-3.5"></i> Images (${inputs.images} required) *
                                        </span>
                                        <label class="flex flex-col items-center justify-center aspect-square rounded-3xl border-2 border-dashed cursor-pointer transition-all hover:bg-blue-600/5 group ${isDarkMode ? 'border-slate-800 hover:border-blue-500' : 'border-slate-200 hover:border-blue-400'}">
                                            <div class="p-3 rounded-full bg-blue-600/10 text-blue-500 group-hover:scale-110 transition-transform mb-3">
                                                <i data-lucide="image" class="w-6 h-6"></i>
                                            </div>
                                            <span class="text-[10px] font-black uppercase tracking-widest opacity-60">Upload ${inputs.images} Image${inputs.images > 1 ? 's' : ''}</span>
                                            <input type="file" multiple class="hidden" onchange="handleFileUpload('images', event)" accept="image/*">
                                        </label>
                                        <div id="images-preview" class="grid grid-cols-${Math.min(inputs.images, 3)} gap-2"></div>
                                    </div>
                                    ` : ''}

                                    ${inputs.videos > 0 ? `
                                    <!-- Videos Upload -->
                                    <div class="space-y-4 ${!inputs.icon && !inputs.images ? 'col-span-full' : ''}">
                                        <span class="text-xs font-black uppercase tracking-widest opacity-40 flex items-center gap-2">
                                            <i data-lucide="video" class="w-3.5 h-3.5"></i> Video *
                                        </span>
                                        <label class="flex flex-col items-center justify-center aspect-square rounded-3xl border-2 border-dashed cursor-pointer transition-all hover:bg-blue-600/5 group ${isDarkMode ? 'border-slate-800 hover:border-blue-500' : 'border-slate-200 hover:border-blue-400'}">
                                            <div class="p-3 rounded-full bg-blue-600/10 text-blue-500 group-hover:scale-110 transition-transform mb-3">
                                                <i data-lucide="video" class="w-6 h-6"></i>
                                            </div>
                                            <span class="text-[10px] font-black uppercase tracking-widest opacity-60">Upload MP4</span>
                                            <input type="file" class="hidden" onchange="handleFileUpload('videos', event)" accept="video/*">
                                        </label>
                                        <div id="videos-preview"></div>
                                    </div>
                                    ` : ''}
                                </section>
                            </div>
                        </div>

                        <!-- PREVIEW & EXPORT PANEL -->
                        <div class="space-y-8 sticky top-32">
                            <div class="aspect-[4/3] rounded-[2.5rem] border-4 border-slate-800 relative overflow-hidden flex items-center justify-center p-12 transition-all ${isDarkMode ? 'bg-[#0a0c10]' : 'bg-slate-200 shadow-inner'}">
                                <div class="absolute top-6 left-6 flex items-center gap-2 bg-black/40 backdrop-blur-md px-4 py-2 rounded-full border border-white/10">
                                    <i data-lucide="monitor" class="w-3.5 h-3.5 text-blue-400"></i>
                                    <span class="text-[10px] font-black uppercase tracking-widest text-white">Live Preview</span>
                                </div>

                                <div id="ad-preview" class="w-[300px] h-[250px] bg-white rounded-lg shadow-[0_40px_100px_rgba(0,0,0,0.5)] relative overflow-hidden text-black">
                                    ${renderPreview()}
                                </div>
                            </div>

                            <!-- Export Panel -->
                            <div class="p-8 rounded-[2.5rem] border-2 transition-all ${isDarkMode ? 'bg-blue-600/5 border-blue-600/30' : 'bg-blue-50 border-blue-200'}">
                                <div class="flex flex-col md:flex-row items-center justify-between gap-6 mb-8">
                                    <div class="flex items-center gap-5 text-center md:text-left">
                                        <div class="p-4 rounded-2xl ${isDarkMode ? 'bg-blue-600' : 'bg-blue-600 shadow-lg shadow-blue-600/30'}">
                                            <i data-lucide="file-archive" class="w-7 h-7 text-white"></i>
                                        </div>
                                        <div>
                                            <h4 class="text-xl font-black tracking-tight">Export Ad Package</h4>
                                            <p class="text-xs font-bold opacity-50 uppercase tracking-widest">Google Ads Ready ZIP</p>
                                        </div>
                                    </div>
                                    
                                    <button onclick="generateZip()" id="export-btn" class="w-full md:w-auto px-10 py-5 bg-blue-600 hover:bg-blue-700 text-white font-black rounded-2xl transition-all shadow-xl shadow-blue-600/30 active:scale-95 flex items-center justify-center gap-3 uppercase tracking-widest text-sm">
                                        <i data-lucide="download" class="w-5 h-5"></i>
                                        Generate ZIP
                                    </button>
                                </div>

                                <div id="progress-container"></div>
                            </div>
                        </div>

                    </div>
                </div>
            `;
        }

        // Render Preview
        // Render Preview (LIVE VERSION - Shows Real Template)
function renderPreview() {
    if (!selectedTemplate) return '';

    const templateId = selectedTemplate.id;
    const inputs = selectedTemplate.inputs;

    // Get actual user data
    const title = adData.title || 'Your App Name';
    const tagline = adData.tagline || 'Your tagline here';
    const iconUrl = adData.icon?.url || 'assets/icon.png';
    const img1 = adData.images[0]?.url || 'assets/feature_1_image.png';
    const img2 = adData.images[1]?.url || 'assets/feature_2_image.png';
    const img3 = adData.images[2]?.url || 'assets/feature_3_image.png';
    const videoUrl = adData.videos[0]?.url || 'assets/app_preview.mp4';

    // Generate live preview HTML based on template
    let previewHTML = '';

    switch(templateId) {
        case 1: // Template 1: Store Style
            previewHTML = `
                <div style="height:100%; display:flex; flex-direction:column; align-items:center; justify-content:center; padding:20px; background: radial-gradient(circle at top, #1a1a3e 0%, #0f0f23 100%); color:white; font-family: 'Space Grotesk', sans-serif;">
                    <img src="${iconUrl}" style="width:80px; height:80px; border-radius:18px; margin-bottom:12px; box-shadow: 0 10px 30px rgba(0,0,0,0.5);">
                    <div style="color: #FFD700; font-size:14px; margin-bottom:6px;">★★★★★ 4.8</div>
                    <h1 style="font-size:20px; font-weight:700; margin-bottom:4px; text-align:center;">${title}</h1>
                    <p style="font-size:11px; opacity:0.9; text-align:center; margin-bottom:16px;">${tagline}</p>
                    <div style="display:flex; gap:8px; margin-bottom:16px;">
                        <span style="background:rgba(255,255,255,0.1); padding:4px 10px; border-radius:6px; font-size:10px;">#1 Trending</span>
                        <span style="background:rgba(255,255,255,0.1); padding:4px 10px; border-radius:6px; font-size:10px;">FREE</span>
                    </div>
                    <button style="background: linear-gradient(135deg, #8b5cf6 0%, #06b6d4 100%); color:white; padding:12px 32px; border-radius:30px; border:none; font-size:14px; font-weight:700;">DOWNLOAD FREE</button>
                </div>
            `;
            break;

        case 2: // Template 2: Feature Orbit
            previewHTML = `
                <div style="height:100%; display:flex; flex-direction:column; align-items:center; justify-content:space-between; padding:16px; background: linear-gradient(135deg, #0f0f23, #1a1a3e); color:white; font-family: 'Space Grotesk', sans-serif;">
                    <div style="text-align:center;">
                        <h1 style="font-size:18px; font-weight:700; margin-bottom:4px;">${title}</h1>
                        <p style="font-size:11px; opacity:0.9;">${tagline}</p>
                    </div>
                    <div style="display:flex; gap:8px; align-items:center; justify-content:center;">
                        <img src="${img1}" style="width:50px; height:50px; border-radius:10px; opacity:0.6;">
                        <img src="${img2}" style="width:70px; height:70px; border-radius:12px; border:2px solid #8b5cf6; box-shadow: 0 10px 30px rgba(139, 92, 246, 0.4);">
                        <img src="${img3}" style="width:50px; height:50px; border-radius:10px; opacity:0.6;">
                    </div>
                    <button style="background: linear-gradient(135deg, #8b5cf6, #6366f1); color:white; padding:10px 28px; border-radius:30px; border:none; font-size:13px; font-weight:700;">Download Free</button>
                </div>
            `;
            break;

        case 3: // Template 3: Premium Cards
            previewHTML = `
                <div style="height:100%; display:flex; flex-direction:column; align-items:center; justify-content:space-between; padding:20px; background: radial-gradient(circle at center, #1a1a3e 0%, #0f0f23 100%); color:white; font-family: 'Space Grotesk', sans-serif;">
                    <div style="text-align:center;">
                        <h1 style="font-size:20px; font-weight:700; margin-bottom:4px;">${title}</h1>
                        <p style="font-size:11px; opacity:0.9;">${tagline}</p>
                    </div>
                    <div style="display:flex; gap:8px; align-items:center;">
                        <div style="background:rgba(255,255,255,0.1); backdrop-filter:blur(10px); border-radius:12px; padding:12px; transform:scale(0.8); opacity:0.6;">
                            <img src="${img1}" style="width:40px; height:40px; border-radius:8px;">
                        </div>
                        <div style="background:rgba(255,255,255,0.1); backdrop-filter:blur(10px); border:1px solid #8b5cf6; border-radius:12px; padding:12px;">
                            <img src="${img2}" style="width:50px; height:50px; border-radius:8px;">
                        </div>
                        <div style="background:rgba(255,255,255,0.1); backdrop-filter:blur(10px); border-radius:12px; padding:12px; transform:scale(0.8); opacity:0.6;">
                            <img src="${img3}" style="width:40px; height:40px; border-radius:8px;">
                        </div>
                    </div>
                    <button style="background: linear-gradient(135deg, #8b5cf6 0%, #6366f1 100%); color:white; padding:12px 36px; border-radius:30px; border:none; font-size:14px; font-weight:700;">DOWNLOAD FREE</button>
                </div>
            `;
            break;

        case 4: // Template 4: 3D Scan Pane
            previewHTML = `
                <div style="height:100%; display:flex; flex-direction:column; align-items:center; justify-content:space-between; padding:20px; background: radial-gradient(circle at 50% 50%, #3a035a 0%, #000000 100%); color:white; font-family: 'Space Grotesk', sans-serif;">
                    <h1 style="font-size:24px; font-weight:800; background: linear-gradient(180deg, #FFFFFF 20%, #00d4ff 60%, #ff00ff 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; text-transform:uppercase;">${title}</h1>
                    <div style="position:relative; width:140px; height:200px; border-radius:10px; overflow:hidden; border:1px solid rgba(255,255,255,0.2); box-shadow: 0 20px 40px rgba(0,0,0,0.5);">
                        <img src="${img1}" style="width:100%; height:100%; object-fit:cover;">
                        <div style="position:absolute; top:0; left:0; right:0; height:3px; background: linear-gradient(to right, transparent, #00d4ff, #ff00ff, #00d4ff, transparent);"></div>
                    </div>
                    <button style="background: linear-gradient(135deg, #ff00ff 0%, #a100ff 100%); color:white; padding:10px 32px; border-radius:4px; border:none; font-size:12px; font-weight:800; text-transform:uppercase;">START NOW</button>
                </div>
            `;
            break;

        case 5: // Template 5: Minimal Blur
            previewHTML = `
                <div style="height:100%; position:relative; display:flex; flex-direction:column; align-items:center; justify-content:center; background:#000;">
                    <img src="${img1}" style="position:absolute; inset:0; width:100%; height:100%; object-fit:cover; filter:blur(15px) brightness(0.4);">
                    <div style="position:relative; z-index:10; text-align:center; color:white; font-family: 'Space Grotesk', sans-serif;">
                        <img src="${iconUrl}" style="width:70px; height:70px; border-radius:16px; margin-bottom:16px; box-shadow: 0 15px 35px rgba(0,0,0,0.6);">
                        <h1 style="font-size:24px; font-weight:800; text-transform:uppercase; margin-bottom:20px; text-shadow: 0 4px 15px rgba(0,0,0,0.8);">${title}</h1>
                        <button style="background:#FFFFFF; color:#000; padding:14px 40px; border-radius:4px; border:none; font-size:16px; font-weight:800; text-transform:uppercase;">Download The App</button>
                    </div>
                </div>
            `;
            break;

        case 6: // Template 6: Video Scan
            previewHTML = `
                <div style="height:100%; display:flex; flex-direction:column; align-items:center; justify-content:space-between; padding:20px; background: radial-gradient(circle at 50% 50%, #3a035a 0%, #000000 100%); color:white; font-family: 'Space Grotesk', sans-serif;">
                    <h1 style="font-size:24px; font-weight:800; background: linear-gradient(180deg, #FFFFFF 20%, #00d4ff 60%, #ff00ff 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; text-transform:uppercase;">${title}</h1>
                    <div style="position:relative; width:140px; height:200px; border-radius:10px; overflow:hidden; border:1px solid rgba(255,255,255,0.2); box-shadow: 0 20px 40px rgba(0,0,0,0.5);">
                        ${adData.videos[0] ? `<video src="${videoUrl}" autoplay muted loop style="width:100%; height:100%; object-fit:cover;"></video>` : `<img src="${img1}" style="width:100%; height:100%; object-fit:cover;">`}
                        <div style="position:absolute; top:0; left:0; right:0; height:3px; background: linear-gradient(to right, transparent, #00d4ff, #ff00ff, #00d4ff, transparent);"></div>
                    </div>
                    <button style="background: linear-gradient(135deg, #ff00ff 0%, #a100ff 100%); color:white; padding:10px 32px; border-radius:4px; border:none; font-size:12px; font-weight:800; text-transform:uppercase;">START NOW</button>
                </div>
            `;
            break;
    }

    return previewHTML;
}

        // Template Selection
        function selectTemplate(id) {
            selectedTemplate = TEMPLATES.find(t => t.id === id);
            // Reset adData when switching templates
            adData = {
                title: '',
                tagline: '',
                language: 'en',
                icon: null,
                images: [],
                videos: []
            };
            showPage('editor');
        }

        // Scroll Templates
        function scrollTemplates(direction) {
            const container = document.getElementById('template-scroll');
            if (!container) return;
            
            const scrollAmount = direction === 'left' ? -500 : 500;
            container.scrollBy({ left: scrollAmount, behavior: 'smooth' });
        }

        // Update Ad Data
        function updateAdData(field, value) {
            adData[field] = value;
            const preview = document.getElementById('ad-preview');
            if (preview) {
                preview.innerHTML = renderPreview();
            }
        }

        // File Upload Handler
        function handleFileUpload(type, event) {
            const files = Array.from(event.target.files);
            
            if (type === 'icon') {
                if (files.length > 0) {
                    const file = files[0];
                    const url = URL.createObjectURL(file);
                    adData.icon = { file, url };
                    displayIconPreview();
                }
            } else if (type === 'images') {
                const requiredImages = selectedTemplate.inputs.images;
                if (files.length !== requiredImages) {
                    alert(`Please upload exactly ${requiredImages} image${requiredImages > 1 ? 's' : ''}`);
                    event.target.value = '';
                    return;
                }
                
                adData.images = [];
                files.forEach(file => {
                    const url = URL.createObjectURL(file);
                    adData.images.push({ file, url });
                });
                displayFilePreviews('images');
            } else if (type === 'videos') {
                if (files.length > 0) {
                    const file = files[0];
                    const url = URL.createObjectURL(file);
                    adData.videos = [{ file, url }];
                    displayFilePreviews('videos');
                }
            }
            
            updateAdData('preview', true);
        }

        // Display Icon Preview
        function displayIconPreview() {
            const container = document.getElementById('icon-preview');
            if (!container || !adData.icon) return;

            container.innerHTML = `
                <div class="relative group">
                    <img src="${adData.icon.url}" class="w-full h-20 object-cover rounded-lg border ${isDarkMode ? 'border-slate-700' : 'border-slate-200'}">
                    <button onclick="removeFile('icon', 0)" class="absolute top-1 right-1 bg-red-500 text-white rounded-full p-1 opacity-0 group-hover:opacity-100 transition-opacity">
                        <i data-lucide="x" class="w-3 h-3"></i>
                    </button>
                </div>
            `;
            
            lucide.createIcons();
        }

        // Display File Previews
        function displayFilePreviews(type) {
            const container = document.getElementById(`${type}-preview`);
            if (!container) return;

            const items = adData[type];
            if (!items || items.length === 0) {
                container.innerHTML = '';
                return;
            }

            container.innerHTML = items.map((item, idx) => `
                <div class="relative group">
                    ${type === 'images' 
                        ? `<img src="${item.url}" class="w-full h-20 object-cover rounded-lg border ${isDarkMode ? 'border-slate-700' : 'border-slate-200'}">` 
                        : `<video src="${item.url}" class="w-full h-20 object-cover rounded-lg border ${isDarkMode ? 'border-slate-700' : 'border-slate-200'}"></video>`
                    }
                    <button onclick="removeFile('${type}', ${idx})" class="absolute top-1 right-1 bg-red-500 text-white rounded-full p-1 opacity-0 group-hover:opacity-100 transition-opacity">
                        <i data-lucide="x" class="w-3 h-3"></i>
                    </button>
                </div>
            `).join('');
            
            lucide.createIcons();
        }

        // Remove File
        function removeFile(type, index) {
            if (type === 'icon') {
                adData.icon = null;
                const container = document.getElementById('icon-preview');
                if (container) container.innerHTML = '';
            } else {
                adData[type].splice(index, 1);
                displayFilePreviews(type);
            }
            updateAdData('preview', true);
        }

        // Filter Languages
        function filterLanguages(searchTerm) {
            const select = document.getElementById('language-select');
            if (!select) return;
            
            const options = select.querySelectorAll('option');
            searchTerm = searchTerm.toLowerCase();
            
            options.forEach(option => {
                const langName = option.textContent.toLowerCase();
                const langCode = option.value.toLowerCase();
                
                if (langName.includes(searchTerm) || langCode.includes(searchTerm)) {
                    option.style.display = '';
                } else {
                    option.style.display = 'none';
                }
            });
        }

        // Initialize on Load
        window.addEventListener('load', initApp);
    </script>

</body>
</html>
